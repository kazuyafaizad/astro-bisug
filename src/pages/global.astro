---
// Component Imports
import Nav from '../components/Nav.astro';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';

---
<html lang="en">
<head>
  <BaseHead title="Bi-Su Official Global Website | Global" description="Bi-Su Official Global Websiteâ€•company,brands,sustainability,birdnest">
    <script src="../assets/js/point-map.js?2" defer></script>
</BaseHead>
</head>
<style lang="scss">
$medium : 768px;
        canvas {
            padding: 50px 0;
            box-sizing: content-box;
            width: 100%;
            height: 100%;

        }

        .tips-wrap{
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            padding: 5px 10px;
            width:4rem;
            justify-content: center;
            align-items: center;
        }
        .tips-wrap img{
          transform: translate(-63%,-100%);
        }
        .tips{
          height:2rem;
        }
        .tips2{
          /*
          background:#fff;
          padding:7px;
          border-radius:5px;
          border:1px solid gray;
          */
        }
        embed{
          pointer-events:none;
        }
        .marker:hover{
          cursor:pointer;
        }
         #map{
           position:relative;
                & canvas{
                  position:absolute; top:0; left:0; z-index:0
                }
                @media screen and (max-width: $medium) {
                  width:1080px;
                  overflow:scroll;
                }
              }
</style>
  <body>
  <div class="flex flex-col h-screen justify-between">
    <Nav global="active" DIR=".."/>
      <main>



      <section>
        <h1 class="text-3xl my-10 block text-center">Deliver the value to the world</h1>
      <div id="map-wrapper" class="overflow-scroll">
        <div id="map">
          <div class="tips-wrap">
            <img class="marker"/>

          </div>
        </div>
        </div>
      </section>

      <div class="absolute inset-0 flex items-center justify-center bg-gray-700 bg-opacity-50" id="modal">
        <div class="w-full max-w-sm p-6 bg-white divide-y divide-gray-500">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl" id="modal-title"></h3>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 close hover:cursor-pointer" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>

            </div>
            <div class="pt-4 tips2">
            <a class="instagram hidden flex">
             <embed src="../assets/icons8-instagram.svg" class="h-8"/>
             Instagram
            </a>
            <a class="facebook hidden flex">
              <embed src="../assets/icons8-facebook.svg" class="h-8"/>
              Facebook
              </a>
               <a class="weibo hidden flex">
              <embed src="../assets/sina-weibo.svg" class="h-8"/>
              </a>
            </div>
        </div>
    </div>


  </main>
    <Footer />
    </div>
     <script type="text/javascript">

document.addEventListener("DOMContentLoaded", function () {

      // Create an instance
      let map = new PointMap('map');

      map.config.eventPointColor = "#333";
      map.config.mapBgColor = "#B8A273";
      map.config.activePointColor = '#333';
      map.config.mapActiveBgColor ='#B8A273';
      // Add event points

     map.addEvents([{
        name: 'Singapore',
        coordinate: [-70.8198, 1.3521 ],
        pointer : "../assets/maps/sg.png",
        instagram:"http://www.instagram.com",
        facebook:"http://www.facebook.com"
    }, {
        name: 'Japan',
        coordinate: [-40.5902 ,130.4017],
        pointer : "../assets/maps/jpn.png",
         instagram:"http://www.instagram.com",
        facebook:"http://www.facebook.com"
    },{
        name: 'USA',
        coordinate: [77.0369, 38.9072 ],
        pointer : "../assets/maps/usa.png",
         instagram:"http://www.instagram.com",
        facebook:"http://www.facebook.com"
    },{
        name: 'China',
        coordinate: [-70.9042 ,116.4074],
        pointer : "../assets/maps/ch.png",
         instagram:"http://www.instagram.com",
        weibo:"http://www.weibo.com"
    }]);
const tips = document.querySelector('.tips-wrap');
const marker = document.querySelector('.marker');
const tips2 = document.querySelector('.tips2');
const modalTitle = document.querySelector('#modal-title');

let infoBox = function(e,data){
  if (data) {

            let container = document.querySelector("#map-wrapper");
            let rect = container.getBoundingClientRect();
            let x = e.clientX + container.scrollLeft - rect.left;
            let y = e.clientY + container.scrollTop - rect.top;

            tips.style.left = `${x}px`;
            tips.style.top = `${y }px`;

            tips.style.display = 'flex';

            modalTitle.innerText= data.map(d => d.name);

            marker.src = data.map(d => d.pointer);
            modalInfo(e,data);


        } else {
            //tips.style.display = 'none';
        }
  }

        let modalInfo = function(e,data){
            const fb = tips2.querySelector(".facebook");
            const ig = tips2.querySelector(".instagram");
            const weibo = tips2.querySelector(".weibo");

            ig.href = data.map(d => {d.instagram;d.instagram ? ig.classList.remove("hidden") : ig.classList.add("hidden") });
            fb.href = data.map(d => {d.facebook;d.facebook ? fb.classList.remove("hidden") : fb.classList.add("hidden")});
            weibo.href = data.map(d => {d.weibo;d.weibo ? weibo.classList.remove("hidden") : weibo.classList.add("hidden")});
        }

       document.querySelector(".marker").addEventListener('click', function(e, data) {
          gsap.to("#modal",{y:0})
          modalInfo(e,data);
      });
      document.querySelector(".close").addEventListener('click', function(e, data) {
          gsap.to("#modal",{y:"-100%"})
      });

      map.on("mousemove", (e,data) => {
         infoBox(e,data);
      });

      var tl = gsap.timeline();
      gsap.set("#map",{scaleX:1,scaleY:1,x:-50});
      gsap.set("#modal",{y:"-100%"})

      tl.to("#map",{x:0,duration:1});
      if(window.screen.width <= 769 ){
            //tl.to("#map", {scaleX: 1.2,scaleY:1.2, duration: 1});
            tl.to("#map",{ scrollTo: 500})
      }

      });
    </script>
  </body>
</html>